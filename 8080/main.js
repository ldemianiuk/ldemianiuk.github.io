!function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){},function(t,e,r){"use strict";r.r(e);const s=/:([0-9A-Fa-f]{8,})([0-9A-Fa-f]{2})(?:\r\n|\r|\n|)/g;function n(t){return 255&-t.reduce((t,e)=>t+e,0)}function i(t){return t.toString(16).toUpperCase().padStart(2,"0")}Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};class o{constructor(t){if(this._blocks=new Map,this.ip=null,t&&"function"==typeof t[Symbol.iterator])for(const e of t){if(!(e instanceof Array)||2!==e.length)throw new Error("First parameter to MemoryMap constructor must be an iterable of [addr, bytes] or undefined");this.set(e[0],e[1])}else if("object"==typeof t){const e=Object.keys(t);for(const r of e)this.set(parseInt(r),t[r])}else if(null!=t)throw new Error("First parameter to MemoryMap constructor must be an iterable of [addr, bytes] or undefined")}set(t,e){if(!Number.isInteger(t))throw new Error("Address passed to MemoryMap is not an integer");if(t<0)throw new Error("Address passed to MemoryMap is negative");if(!(e instanceof Uint8Array))throw new Error("Bytes passed to MemoryMap are not an Uint8Array");return this._blocks.set(t,e)}get(t){return this._blocks.get(t)}clear(){return this._blocks.clear()}delete(t){return this._blocks.delete(t)}entries(){return this._blocks.entries()}forEach(t,e){return this._blocks.forEach(t,e)}has(t){return this._blocks.has(t)}keys(){return this._blocks.keys()}values(){return this._blocks.values()}get size(){return this._blocks.size}[Symbol.iterator](){return this._blocks[Symbol.iterator]()}static fromHex(t,e=1/0){const r=new o;let a,u=0,c=0,h=0;for(s.lastIndex=0;null!==(a=s.exec(t));){if(c++,u!==a.index)throw new Error("Malformed hex file: Could not parse between characters "+u+" and "+a.index+' ("'+t.substring(u,Math.min(a.index,u+16)).trim()+'")');u=s.lastIndex;const[,o,l]=a,f=new Uint8Array(o.match(/[\da-f]{2}/gi).map(t=>parseInt(t,16))),p=f[0];if(p+4!==f.length)throw new Error("Mismatched record length at record "+c+" ("+a[0].trim()+"), expected "+p+" data bytes but actual length is "+(f.length-4));const g=n(f);if(parseInt(l,16)!==g)throw new Error("Checksum failed at record "+c+" ("+a[0].trim()+"), should be "+g.toString(16));const A=(f[1]<<8)+f[2],d=f[3],y=f.subarray(4);if(0===d){if(r.has(h+A))throw new Error("Duplicated data at record "+c+" ("+a[0].trim()+")");if(A+y.length>65536)throw new Error("Data at record "+c+" ("+a[0].trim()+") wraps over 0xFFFF. This would trigger ambiguous behaviour. Please restructure your data so that for every record the data offset plus the data length do not exceed 0xFFFF.");r.set(h+A,y)}else{if(0!==A)throw new Error("Record "+c+" ("+a[0].trim()+") must have 0000 as data offset.");switch(d){case 1:if(u!==t.length)throw new Error("There is data after an EOF record at record "+c);return r.join(e);case 2:h=(y[0]<<8)+y[1]<<4;break;case 3:r.ip=y[3]+(y[2]<<8);break;case 4:h=(y[0]<<8)+y[1]<<16;break;case 5:break;default:throw new Error("Invalid record type 0x"+i(d)+" at record "+c+" (should be between 0x00 and 0x05)")}}}throw c?new Error("No EOF record at end of file"):new Error("Malformed .hex file, could not parse any registers")}join(t=1/0){const e=Array.from(this.keys()).sort((t,e)=>t-e),r=new Map;let s=-1,n=-1;for(let i=0,o=e.length;i<o;i++){const o=e[i],a=this.get(e[i]).length;if(n===o&&n-s<t)r.set(s,r.get(s)+a),n+=a;else{if(!(n<=o))throw new Error("Overlapping data around address 0x"+o.toString(16));r.set(o,a),s=o,n=o+a}}const i=new o;let a;i.ip=this.ip;let u=-1;for(let t=0,s=e.length;t<s;t++){const s=e[t];r.has(s)&&(a=new Uint8Array(r.get(s)),i.set(s,a),u=s),a.set(this.get(s),s-u)}return i}static overlapMemoryMaps(t){const e=new Set;for(const[,r]of t)for(const[t,s]of r)e.add(t),e.add(t+s.length);const r=Array.from(e.values()).sort((t,e)=>t-e),s=new Map;for(let e=0,n=r.length-1;e<n;e++){const n=r[e],i=r[e+1],o=[];for(const[e,r]of t){const t=Array.from(r.keys()).reduce((t,e)=>e>n?t:Math.max(t,e),-1);if(-1!==t){const s=r.get(t),a=n-t,u=i-t;a<s.length&&o.push([e,s.subarray(a,u)])}}o.length&&s.set(n,o)}return s}static flattenOverlaps(t){return new o(Array.from(t.entries()).map(([t,e])=>[t,e[e.length-1][1]]))}paginate(t=1024,e=255){if(t<=0)throw new Error("Page size must be greater than zero");const r=new o;let s;const n=Array.from(this.keys()).sort((t,e)=>t-e);for(let i=0,o=n.length;i<o;i++){const o=n[i],a=this.get(o),u=a.length,c=o+u;for(let n=o-o%t;n<c;n+=t){s=r.get(n),s||(s=new Uint8Array(t),s.fill(e),r.set(n,s));const i=n-o;let c;i<=0?(c=a.subarray(0,Math.min(t+i,u)),s.set(c,-i)):(c=a.subarray(i,i+Math.min(t,u-i)),s.set(c,0))}}return r}getUint32(t,e){const r=Array.from(this.keys());for(let s=0,n=r.length;s<n;s++){const n=r[s],i=this.get(n),o=n+i.length;if(n<=t&&t+4<=o)return new DataView(i.buffer,t-n,4).getUint32(0,e)}}asHexString(t=16){let e=0,r=-65536;const s=[];if(t<=0)throw new Error("Size of record must be greater than zero");if(t>255)throw new Error("Size of record must be less than 256");const o=new Uint8Array(6),a=new Uint8Array(4),u=Array.from(this.keys()).sort((t,e)=>t-e);for(let h=0,l=u.length;h<l;h++){const l=u[h],f=this.get(l);if(!(f instanceof Uint8Array))throw new Error("Block at offset "+l+" is not an Uint8Array");if(l<0)throw new Error("Block at offset "+l+" has a negative thus invalid address");const p=f.length;if(!p)continue;if(l>r+65535&&(r=l-l%65536,e=0,o[0]=2,o[1]=0,o[2]=0,o[3]=4,o[4]=r>>24,o[5]=r>>16,s.push(":"+Array.prototype.map.call(o,i).join("")+i(n(o)))),l<r+e)throw new Error("Block starting at 0x"+l.toString(16)+" overlaps with a previous block.");e=l%65536;let g=0;const A=l+p;if(A>4294967295)throw new Error("Data cannot be over 0xFFFFFFFF");for(;r+e<A;){e>65535&&(r+=65536,e=0,o[0]=2,o[1]=0,o[2]=0,o[3]=4,o[4]=r>>24,o[5]=r>>16,s.push(":"+Array.prototype.map.call(o,i).join("")+i(n(o))));let u=-1;for(;e<65536&&u;)if(u=Math.min(t,A-r-e,65536-e),u){a[0]=u,a[1]=e>>8,a[2]=e,a[3]=0;const t=f.subarray(g,g+u);s.push(":"+Array.prototype.map.call(a,i).join("")+Array.prototype.map.call(t,i).join("")+i((c=t,255&-(a.reduce((t,e)=>t+e,0)+c.reduce((t,e)=>t+e,0))))),g+=u,e+=u}}}var c;return s.push(":00000001FF"),s.join("\n")}clone(){const t=new o;for(let[e,r]of this)t.set(e,new Uint8Array(r));return t}static fromPaddedUint8Array(t,e=255,r=64){if(!(t instanceof Uint8Array))throw new Error("Bytes passed to fromPaddedUint8Array are not an Uint8Array");const s=new o;let n=0,i=-1,a=0,u=!1;const c=t.length;for(let o=0;o<c;o++){t[o]===e?(n++,n>=r&&(-1!==i&&s.set(a,t.subarray(a,i+1)),u=!0)):(u&&(u=!1,a=o),i=o,n=0)}return u||-1===i||s.set(a,t.subarray(a,c)),s}slice(t,e=1/0){if(e<0)throw new Error("Length of the slice cannot be negative");const r=new o;for(let[s,n]of this){const i=n.length;if(s+i>=t&&s<t+e){const o=Math.max(t,s),a=Math.min(t+e,s+i)-o,u=o-s;a>0&&r.set(o,n.subarray(u,u+a))}}return r}slicePad(t,e,r=255){if(e<0)throw new Error("Length of the slice cannot be negative");const s=new Uint8Array(e).fill(r);for(let[r,n]of this){const i=n.length;if(r+i>=t&&r<t+e){const o=Math.max(t,r),a=Math.min(t+e,r+i)-o,u=o-r;a>0&&s.set(n.subarray(u,u+a),o-t)}}return s}contains(t){for(let[e,r]of t){const t=r.length,s=this.slice(e,t).join().get(e);if(!s||s.length!==t)return!1;for(const t in r)if(r[t]!==s[t])return!1}return!0}}var a=o,u=["NOP","LXI","STAX","INX","INR","DCR","MVI","RLC","NOP","DAD","LDAX","DCX","INR","DCR","MVI","RRC","NOP","LXI","STAX","INX","INR","DCR","MVI","RAL","NOP","DAD","LDAX","DCX","INR","DCR","MVI","RAR","NOP","LXI","SHLD","INX","INR","DCR","MVI","DAA","NOP","DAD","LHLD","DCX","INR","DCR","MVI","CMA","NOP","LXI","STA","INX","INR","DCR","MVI","STC","NOP","DAD","LDA","DCX","INR","DCR","MVI","CMC","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","HLT","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","MOV","ADD","ADD","ADD","ADD","ADD","ADD","ADD","ADD","ADC","ADC","ADC","ADC","ADC","ADC","ADC","ADC","SUB","SUB","SUB","SUB","SUB","SUB","SUB","SUB","SBB","SBB","SBB","SBB","SBB","SBB","SBB","SBB","ANA","ANA","ANA","ANA","ANA","ANA","ANA","ANA","XRA","XRA","XRA","XRA","XRA","XRA","XRA","XRA","ORA","ORA","ORA","ORA","ORA","ORA","ORA","ORA","CMP","CMP","CMP","CMP","CMP","CMP","CMP","CMP","RNZ","POP","JNZ","JMP","CNZ","PUSH","ADI","RST","RZ","RET","JZ","JMP","CZ","CALL","ACI","RST","RNC","POP","JNC","OUT","CNC","PUSH","SUI","RST","RC","RET","JC","IN","CC","CALL","SBI","RST","RPO","POP","JPO","XTHL","CPO","PUSH","ANI","RST","RPE","PCHL","JPE","XCHG","CPE","CALL","XRI","RST","RP","POP","JP","DI","CP","PUSH","ORI","RST","RM","SPHL","JM","EI","CM","CALL","CPI","RST"],c=[1,3,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,3,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,3,3,1,1,1,2,1,1,1,3,1,1,1,2,1,1,3,3,1,1,1,2,1,1,1,3,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,1,2,1,1,1,3,3,3,3,2,1,1,1,3,2,3,1,2,1,1,1,3,2,3,3,2,1,1,1,3,1,3,1,2,1,1,1,3,1,3,3,2,1,1,1,3,1,3,1,2,1,1,1,3,1,3,3,2,1],h=["NOP","LXI B","STAX B","INX B","INR B","DCR B","MVI B","RLC","NOP","DAD B","LDAX B","DCX B","INR C","DCR C","MVI C","RRC","NOP","LXI D","STAX D","INX D","INR D","DCR D","MVI D","RAL","NOP","DAD D","LDAX D","DCX D","INR E","DCR E","MVI E","RAR","NOP","LXI H","SHLD","INX H","INR H","DCR H","MVI H","DAA","NOP","DAD H","LHLD","DCX H","INR L","DCR L","MVI L","CMA","NOP","LXI SP","STA","INX SP","INR M","DCR M","MVI M","STC","NOP","DAD SP","LDA","DCX SP","INR A","DCR A","MVI A","CMC","MOV B, B","MOV B, C","MOV B, D","MOV B, E","MOV B, H","MOV B, L","MOV B, M","MOV B, A","MOV C, B","MOV C, C","MOV C, D","MOV C, E","MOV C, H","MOV C, L","MOV C, M","MOV C, A","MOV D, B","MOV D, C","MOV D, D","MOV D, E","MOV D, H","MOV D, L","MOV D, M","MOV D, A","MOV E, B","MOV E, C","MOV E, D","MOV E, E","MOV E, H","MOV E, L","MOV E, M","MOV E, A","MOV H, B","MOV H, C","MOV H, D","MOV H, E","MOV H, H","MOV H, L","MOV H, M","MOV H, A","MOV L, B","MOV L, C","MOV L, D","MOV L, E","MOV L, H","MOV L, L","MOV L, M","MOV L, A","MOV M, B","MOV M, C","MOV M, D","MOV M, E","MOV M, H","MOV M, L","HLT","MOV M, A","MOV A, B","MOV A, C","MOV A, D","MOV A, E","MOV A, H","MOV A, L","MOV A, M","MOV A, A","ADD B","ADD C","ADD D","ADD E","ADD H","ADD L","ADD M","ADD A","ADC B","ADC C","ADC D","ADC E","ADC H","ADC L","ADC M","ADC A","SUB B","SUB C","SUB D","SUB E","SUB H","SUB L","SUB M","SUB A","SBB B","SBB C","SBB D","SBB E","SBB H","SBB L","SBB M","SBB A","ANA B","ANA C","ANA D","ANA E","ANA H","ANA L","ANA M","ANA A","XRA B","XRA C","XRA D","XRA E","XRA H","XRA L","XRA M","XRA A","ORA B","ORA C","ORA D","ORA E","ORA H","ORA L","ORA M","ORA A","CMP B","CMP C","CMP D","CMP E","CMP H","CMP L","CMP M","CMP A","RNZ","POP B","JNZ","JMP","CNZ","PUSH B","ADI","RST 0","RZ","RET","JZ","JMP","CZ","CALL","ACI","RST 1","RNC","POP D","JNC","OUT","CNC","PUSH D","SUI","RST 2","RC","RET","JC","IN","CC","CALL","SBI","RST 3","RPO","POP H","JPO","XTHL","CPO","PUSH H","ANI","RST 4","RPE","PCHL","JPE","XCHG","CPE","CALL","XRI","RST 5","RP","POP PSW","JP","DI","CP","PUSH PSW","ORI","RST 6","RM","SPHL","JM","EI","CM","CALL","CPI","RST 7"],l=[4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,16,5,5,5,7,4,4,10,16,5,5,5,7,4,4,10,13,5,10,10,10,4,4,10,13,5,5,5,7,4,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,7,7,7,7,7,7,7,7,5,5,5,5,5,5,7,5,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,5,10,10,10,11,11,7,11,5,10,10,10,11,17,7,11,5,10,10,10,11,11,7,11,5,10,10,10,11,17,7,11,5,10,10,18,11,11,7,11,5,5,10,5,11,17,7,11,5,10,10,4,11,11,7,11,5,5,10,4,11,17,7,11],f=[!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0],p=["No operation","B <- byte 3, C <- byte 2","(BC) <- A","BC <- BC+1","B <- B+1","B <- B-1","B <- byte 2","A = A << 1; bit 0 = prev bit 7; CY = prev bit 7","INVALID No operation","HL = HL + BC","A <- (BC)","BC = BC-1","C <- C+1","C <-C-1","C <- byte 2","A = A >> 1; bit 7 = prev bit 0; CY = prev bit 0","INVALID No operation","D <- byte 3, E <- byte 2","(DE) <- A","DE <- DE + 1","D <- D+1","D <- D-1","D <- byte 2","A = A << 1; bit 0 = prev CY; CY = prev bit 7","INVALID No operation","HL = HL + DE","A <- (DE)","DE = DE-1","E <-E+1","E <- E-1","E <- byte 2","A = A >> 1; bit 7 = prev bit 7; CY = prev bit 0","INVALID No operation","H <- byte 3, L <- byte 2","(adr) <-L; (adr+1)<-H","HL <- HL + 1","H <- H+1","H <- H-1","H <- byte 2","Decimal adjust after addition","INVALID No operation","HL = HL + HI","L <- (adr); H<-(adr+1)","HL = HL-1","L <- L+1","L <- L-1","L <- byte 2","A <- !A","INVALID No operation","SP.hi <- byte 3, SP.lo <- byte 2","(adr) <- A","SP = SP + 1","(HL) <- (HL)+1","(HL) <- (HL)-1","(HL) <- byte 2","CY = 1","INVALID No operation","HL = HL + SP","A <- (adr)","SP = SP-1","A <- A+1","A <- A-1","A <- byte 2","CY=!CY","B <- B","B <- C","B <- D","B <- E","B <- H","B <- L","B <- (HL)","B <- A","C <- B","C <- C","C <- D","C <- E","C <- H","C <- L","C <- (HL)","C <- A","D <- B","D <- C","D <- D","D <- E","D <- H","D <- L","D <- (HL)","D <- A","E <- B","E <- C","E <- D","E <- E","E <- H","E <- L","E <- (HL)","E <- A","H <- B","H <- C","H <- D","H <- E","H <- H","H <- L","H <- (HL)","H <- A","L <- B","L <- C","L <- D","L <- E","L <- H","L <- L","L <- (HL)","L <- A","(HL) <- B","(HL) <- C","(HL) <- D","(HL) <- E","(HL) <- H","(HL) <- L","Halt","(HL) <- A","A <- B","A <- C","A <- D","A <- E","A <- H","A <- L","A <- (HL)","A <- A","A <- A + B","A <- A + C","A <- A + D","A <- A + E","A <- A + H","A <- A + L","A <- A + (HL)","A <- A + A","A <- A + B + CY","A <- A + C + CY","A <- A + D + CY","A <- A + E + CY","A <- A + H + CY","A <- A + L + CY","A <- A + (HL) + CY","A <- A + A + CY","A <- A - B","A <- A - C","A <- A + D","A <- A - E","A <- A + H","A <- A - L","A <- A + (HL)","A <- A - A","A <- A - B - CY","A <- A - C - CY","A <- A - D - CY","A <- A - E - CY","A <- A - H - CY","A <- A - L - CY","A <- A - (HL) - CY","A <- A - A - CY","A <- A & B","A <- A & C","A <- A & D","A <- A & E","A <- A & H","A <- A & L","A <- A & (HL)","A <- A & A","A <- A ^ B","A <- A ^ C","A <- A ^ D","A <- A ^ E","A <- A ^ H","A <- A ^ L","A <- A ^ (HL)","A <- A ^ A","A <- A | B","A <- A | C","A <- A | D","A <- A | E","A <- A | H","A <- A | L","A <- A | (HL)","A <- A | A","A - B","A - C","A - D","A - E","A - H","A - L","A - (HL)","A - A","if NZ, RET","C <- (sp); B <- (sp+1); sp <- sp+2","if NZ, PC <- adr","PC <= adr","if NZ, CALL adr","(sp-2)<-C; (sp-1)<-B; sp <- sp - 2","A <- A + byte","CALL $0","if Z, RET","PC.lo <- (sp); PC.hi<-(sp+1); SP <- SP+2","if Z, PC <- adr","INVALID PC <= adr","if Z, CALL adr","(SP-1)<-PC.hi;(SP-2)<-PC.lo;SP<-SP-2;PC=adr","A <- A + data + CY","CALL $8","if NCY, RET","E <- (sp); D <- (sp+1); sp <- sp+2","if NCY, PC<-adr","Output AL to port D8","if NCY, CALL adr","(sp-2)<-E; (sp-1)<-D; sp <- sp - 2","A <- A - data","CALL $10","if CY, RET","INVALID RET","if CY, PC<-adr","Input from port D8 to AL","if CY, CALL adr","INVALID CALL","A <- A - data - CY","CALL $18","if PO, RET","L <- (sp); H <- (sp+1); sp <- sp+2","if PO, PC <- adr","L <-> (SP); H <-> (SP+1)","if PO, CALL adr","(sp-2)<-L; (sp-1)<-H; sp <- sp - 2","A <- A & data","CALL $20","if PE, RET","PC.hi <- H; PC.lo <- L","if PE, PC <- adr","H <-> D; L <-> E","if PE, CALL adr","INVALID CALL","A <- A ^ data","CALL $28","if P, RET","flags <- (sp); A <- (sp+1); sp <- sp+2","if P=1 PC <- adr","Disable interrputs","if P, PC <- adr","(sp-2)<-flags; (sp-1)<-A; sp <- sp - 2","A <- A | data","CALL $30","if M, RET","SP=HL","if M, PC <- adr","Enable interrputs","if M, CALL adr","INVALID CALL","A - data","CALL $38"],g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function A(t,e){function r(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function d(t){return"function"==typeof t}var y=!1,C={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;y=t},get useDeprecatedSynchronousErrorHandling(){return y}};function b(t){setTimeout((function(){throw t}),0)}var m={closed:!0,next:function(t){},error:function(t){if(C.useDeprecatedSynchronousErrorHandling)throw t;b(t)},complete:function(){}},R=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();var M=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),H=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r,s=this._parentOrParents,n=this._ctorUnsubscribe,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,s instanceof t)s.remove(this);else if(null!==s)for(var a=0;a<s.length;++a){s[a].remove(this)}if(d(i)){n&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof M?O(t.errors):[t]}}if(R(o)){a=-1;for(var u=o.length;++a<u;){var c=o[a];if(null!==(r=c)&&"object"==typeof r)try{c.unsubscribe()}catch(t){e=e||[],t instanceof M?e=e.concat(O(t.errors)):e.push(t)}}}if(e)throw new M(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var s=r;(r=new t)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var n=r._parentOrParents;if(null===n)r._parentOrParents=this;else if(n instanceof t){if(n===this)return r;r._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return r;n.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function O(t){return t.reduce((function(t,e){return t.concat(e instanceof M?e.errors:e)}),[])}var D=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),E=function(t){function e(r,s,n){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=m;break;case 1:if(!r){i.destination=m;break}if("object"==typeof r){r instanceof e?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new L(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new L(i,r,s,n)}return i}return A(e,t),e.prototype[D]=function(){return this},e.create=function(t,r,s){var n=new e(t,r,s);return n.syncErrorThrowable=!1,n},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(H),L=function(t){function e(e,r,s,n){var i,o=t.call(this)||this;o._parentSubscriber=e;var a=o;return d(r)?i=r:r&&(i=r.next,s=r.error,n=r.complete,r!==m&&(d((a=Object.create(r)).unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=i,o._error=s,o._complete=n,o}return A(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;C.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=C.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):b(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;b(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};C.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),C.useDeprecatedSynchronousErrorHandling)throw t;b(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!C.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return C.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(b(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(E);var S=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function P(t){return t}function v(t){return 0===t.length?P:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var w=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var s=this.operator,n=function(t,e,r){if(t){if(t instanceof E)return t;if(t[D])return t[D]()}return t||e||r?new E(t,e,r):new E(m)}(t,e,r);if(s?n.add(s.call(n,this.source)):n.add(this.source||C.useDeprecatedSynchronousErrorHandling&&!n.syncErrorThrowable?this._subscribe(n):this._trySubscribe(n)),C.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable&&(n.syncErrorThrowable=!1,n.syncErrorThrown))throw n.syncErrorValue;return n},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){C.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,s=e.destination,n=e.isStopped;if(r||n)return!1;t=s&&s instanceof E?s:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=B(e))((function(e,s){var n;n=r.subscribe((function(e){try{t(e)}catch(t){s(t),n&&n.unsubscribe()}}),s,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[S]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:v(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=B(t))((function(t,r){var s;e.subscribe((function(t){return s=t}),(function(t){return r(t)}),(function(){return t(s)}))}))},t.create=function(e){return new t(e)},t}();function B(t){if(t||(t=C.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var V=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),I=function(t){function e(e,r){var s=t.call(this)||this;return s.subject=e,s.subscriber=r,s.closed=!1,s}return A(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(H),N=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return A(e,t),e}(E),_=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return A(e,t),e.prototype[D]=function(){return new N(this)},e.prototype.lift=function(t){var e=new T(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new V;if(!this.isStopped)for(var e=this.observers,r=e.length,s=e.slice(),n=0;n<r;n++)s[n].next(t)},e.prototype.error=function(t){if(this.closed)throw new V;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,s=e.slice(),n=0;n<r;n++)s[n].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new V;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),s=0;s<e;s++)r[s].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new V;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new V;return this.hasError?(t.error(this.thrownError),H.EMPTY):this.isStopped?(t.complete(),H.EMPTY):(this.observers.push(t),new I(this,t))},e.prototype.asObservable=function(){var t=new w;return t.source=this,t},e.create=function(t,e){return new T(t,e)},e}(w),T=function(t){function e(e,r){var s=t.call(this)||this;return s.destination=e,s.source=r,s}return A(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):H.EMPTY},e}(_);function x(t,e){return t<<8|e}function k(t){return 255&t}function U(t){return t>>8}function X(t){return 7&t}function F(t){return t>>3&7}var j=function(){};function Z(t,e){return t<<8|e}var Y=function(){function t(){this.status=new j,this.memory=new Uint8Array(65536),this.registers=new Uint8Array(8),this.sp=new Uint16Array(1),this.pc=new Uint16Array(1),this.output$=new Array(256);for(var t=0;t<256;t++)this.output$[t]=new _;this.reset()}return t.prototype.ret=function(t){void 0===t&&(t=6),this.pc[0]=Z(this.memory[this.sp[0]+1],this.memory[this.sp[0]]),this.sp[0]+=2,this.cycles+=t},t.prototype.sub=function(t,e){var r=255^e,s=t+r+1;return this.setFlags(s),this.setCarry(s),this.status.C=!this.status.C,this.status.A=(15&t)+(15&r)+1>15,s},t.prototype.call=function(t,e,r){void 0===r&&(r=6);var s=Z(t,e);this.sp[0]-=2,this.memory[this.sp[0]]=255&this.pc[0],this.memory[this.sp[0]+1]=function(t){return t>>8}(this.pc[0]),this.pc[0]=s,this.cycles+=r},t.prototype.setAC=function(t,e){this.status.A=(15&t)+(15&e)>15},t.prototype.setCarry=function(t){this.status.C=0!=(256&t)},t.prototype.setFlags=function(t){this.status.S=0!=(128&t),this.status.Z=0==(255&t),this.status.P=f[255&t]},t.prototype.parity=function(t){for(var e=1,r=0;r<8;r++)0!=(t&1<<r)&&e++;return 1==(1&e)},t.prototype.getReg=function(t){return 8===t?2|+this.status.C|+this.status.P<<2|0|+this.status.A<<4|0|+this.status.Z<<6|+this.status.S<<7:6===t?this.memory[Z(this.registers[4],this.registers[5])]:this.registers[t]},t.prototype.setReg=function(t,e){8===t?(this.status.C=0!=(1&e),this.status.P=0!=(4&e),this.status.A=0!=(16&e),this.status.Z=0!=(64&e),this.status.S=0!=(128&e)):6===t?this.memory[Z(this.registers[4],this.registers[5])]=e:this.registers[t]=e},t.prototype.reset=function(){this.registers.fill(0),this.memory.fill(0),this.sp[0]=61440,this.pc[0]=0,this.status.S=this.status.Z=this.status.A=this.status.P=this.status.C=!1,this.running=!0,this.cycles=0,this.instructions=0,this.input=[],this.trace=new Array(65536)},t.prototype.step=function(){if(this.running){var e=this.memory[this.pc[0]],r=u[e],s=c[e],n=this.memory[this.pc[0]+1&65535],i=this.memory[this.pc[0]+2&65535];this.trace[this.pc[0]]=("0000"+this.pc[0].toString(16)).slice(-4)+": "+this.disasm(this.pc[0]),this.pc[0]+=s,t.instructionHandlers[r].bind(this)?t.instructionHandlers[r].bind(this)(e,n,i):console.log("ERROR: "+r),this.cycles+=l[e],this.instructions++}},t.prototype.disasm=function(t,e){var r=this.memory[t],s=h[r],n=c[r];if(e>0){for(var i=[],o=t,a=0;a<e&&o<=65535;a++){var u=this.memory[o],l=c[u];i.push([o,this.disasm(o),p[u]]),o+=l}return i}return 0===e?[]:1===n?s:(s.includes(" ")&&(s+=","),2==n?s+" "+this.memory[t+1&65535].toString(16):s+" "+(this.memory[t+1&65535]+(this.memory[t+2&65535]<<8)).toString(16))},t.prototype.showFlags=function(){console.log("S:"+this.status.S+" Z:"+this.status.Z+" A:"+this.status.A+" P:"+this.status.P+" C:"+this.status.C)},t.registerHandler=function(e,r){t.instructionHandlers[e]=r},t.instructionHandlers={},t}();Y.registerHandler("ACI",(function(t,e){var r=this.getReg(7),s=e,n=this.status.C?1:0,i=r+s+n;this.setReg(7,i),this.setFlags(i),this.setCarry(i),this.status.A=(15&r)+(15&s)+n>15})),Y.registerHandler("ADC",(function(t){var e=this.getReg(7),r=this.getReg(X(t)),s=this.status.C?1:0,n=e+r+s;this.setReg(7,n),this.setFlags(n),this.setCarry(n),this.status.A=(15&e)+(15&r)+s>15})),Y.registerHandler("ADD",(function(t){var e=this.getReg(7),r=this.getReg(X(t)),s=e+r;this.setReg(7,s),this.setFlags(s),this.setCarry(s),this.setAC(e,r)})),Y.registerHandler("ADI",(function(t,e){var r=this.getReg(7),s=e,n=r+s;this.setReg(7,n),this.setFlags(n),this.setCarry(n),this.setAC(r,s)})),Y.registerHandler("ANA",(function(t){var e=this.getReg(7)&this.getReg(X(t));this.setReg(7,e),this.setFlags(e),this.status.C=!1,this.status.A=!1})),Y.registerHandler("ANI",(function(t,e){var r=this.getReg(7)&e;this.setReg(7,r),this.setFlags(r),this.status.C=!1,this.status.A=!1})),Y.registerHandler("CALL",(function(t,e,r){this.call(r,e,0)})),Y.registerHandler("CC",(function(t,e,r){this.status.C&&this.call(r,e)})),Y.registerHandler("CM",(function(t,e,r){this.status.S&&this.call(r,e)})),Y.registerHandler("CMA",(function(t){this.setReg(7,255^this.getReg(7))})),Y.registerHandler("CMC",(function(t){this.status.C=!this.status.C})),Y.registerHandler("CMP",(function(t){this.sub(this.getReg(7),this.getReg(X(t)))})),Y.registerHandler("CNC",(function(t,e,r){this.status.C||this.call(r,e)})),Y.registerHandler("CNZ",(function(t,e,r){this.status.Z||this.call(r,e)})),Y.registerHandler("CP",(function(t,e,r){this.status.S||this.call(r,e)})),Y.registerHandler("CPE",(function(t,e,r){this.status.P&&this.call(r,e)})),Y.registerHandler("CPI",(function(t,e){this.sub(this.getReg(7),e)})),Y.registerHandler("CPO",(function(t,e,r){this.status.P||this.call(r,e)})),Y.registerHandler("CZ",(function(t,e,r){this.status.Z&&this.call(r,e)})),Y.registerHandler("DAA",(function(t){var e=this.getReg(7);((15&e)>9||this.status.A)&&(e+=6,this.setReg(7,e),this.status.A=!0),(e>>4>9||this.status.C)&&(e+=96,this.setReg(7,e),this.status.C=!0)})),Y.registerHandler("DAD",(function(t){var e;if(57===t)e=this.sp[0];else{var r=F(t),s=r-1;e=x(this.getReg(s),this.getReg(r))}var n=e+x(this.getReg(4),this.getReg(5));this.setReg(4,U(n)),this.setReg(5,k(n)),this.status.C=0!=(65536&n)})),Y.registerHandler("DCR",(function(t){var e=this.getReg(F(t))-1;this.setReg(F(t),e),this.setFlags(e),this.setAC(this.getReg(F(t)),255)})),Y.registerHandler("DCX",(function(t){if(59===t)this.sp[0]--;else{var e=F(t),r=e-1,s=x(this.getReg(r),this.getReg(e))-1;this.setReg(r,U(s)),this.setReg(e,k(s))}})),Y.registerHandler("DI",(function(t){})),Y.registerHandler("EI",(function(t){})),Y.registerHandler("HLT",(function(t){this.running=!1,this.pc[0]--})),Y.registerHandler("IN",(function(t,e){switch(e){case 0:this.input.length>0?this.setReg(7,255):this.setReg(7,0);break;case 1:this.setReg(7,this.input.shift());break;default:console.log("IN "+e)}})),Y.registerHandler("INR",(function(t){var e=this.getReg(F(t))+1;this.setReg(F(t),e),this.setFlags(e),this.setAC(this.getReg(F(t)),1)})),Y.registerHandler("INX",(function(t){if(51===t)this.sp[0]++;else{var e=F(t),r=e+1,s=x(this.getReg(e),this.getReg(r))+1;this.setReg(e,U(s)),this.setReg(r,k(s))}})),Y.registerHandler("JC",(function(t,e,r){this.status.C&&(this.pc[0]=x(r,e))})),Y.registerHandler("JM",(function(t,e,r){this.status.S&&(this.pc[0]=x(r,e))})),Y.registerHandler("JMP",(function(t,e,r){this.pc[0]=x(r,e)})),Y.registerHandler("JNC",(function(t,e,r){this.status.C||(this.pc[0]=x(r,e))})),Y.registerHandler("JNZ",(function(t,e,r){this.status.Z||(this.pc[0]=x(r,e))})),Y.registerHandler("JP",(function(t,e,r){this.status.S||(this.pc[0]=x(r,e))})),Y.registerHandler("JPE",(function(t,e,r){this.status.P&&(this.pc[0]=x(r,e))})),Y.registerHandler("JPO",(function(t,e,r){this.status.P||(this.pc[0]=x(r,e))})),Y.registerHandler("JZ",(function(t,e,r){this.status.Z&&(this.pc[0]=x(r,e))})),Y.registerHandler("LDA",(function(t,e,r){this.setReg(7,this.memory[x(r,e)])})),Y.registerHandler("LDAX",(function(t){var e;e=10===t?x(this.registers[0],this.registers[1]):x(this.registers[2],this.registers[3]),this.setReg(7,this.memory[e])})),Y.registerHandler("LHLD",(function(t,e,r){this.setReg(5,this.memory[x(r,e)]),this.setReg(4,this.memory[x(r,e)+1&65535])})),Y.registerHandler("LXI",(function(t,e,r){if(49===t)this.sp[0]=x(r,e);else{var s=F(t),n=s+1;this.setReg(s,r),this.setReg(n,e)}})),Y.registerHandler("MOV",(function(t){this.setReg(F(t),this.getReg(X(t)))})),Y.registerHandler("MVI",(function(t,e){this.setReg(F(t),e)})),Y.registerHandler("NOP",(function(t){})),Y.registerHandler("ORA",(function(t){var e=this.getReg(7)|this.getReg(X(t));this.setReg(7,e),this.setFlags(e),this.status.C=!1,this.status.A=!1})),Y.registerHandler("ORI",(function(t,e){var r=this.getReg(7)|e;this.setReg(7,r),this.setFlags(r),this.status.C=!1,this.status.A=!1})),Y.registerHandler("OUT",(function(t,e){this.output$[e].observers.length>0?this.output$[e].next(this.getReg(7)):console.log("OUT "+e+", "+this.getReg(7))})),Y.registerHandler("PCHL",(function(t){this.pc[0]=x(this.getReg(4),this.getReg(5))})),Y.registerHandler("POP",(function(t){var e=x(this.memory[this.sp[0]+1],this.memory[this.sp[0]]);this.sp[0]+=2,241===t?(this.setReg(7,U(e)),this.setReg(8,k(e))):(this.setReg(F(t),U(e)),this.setReg(F(t)+1,k(e)))})),Y.registerHandler("PUSH",(function(t){var e;e=245===t?x(this.getReg(7),this.getReg(8)):x(this.getReg(F(t)),this.getReg(F(t)+1)),this.sp[0]-=2,this.memory[this.sp[0]]=k(e),this.memory[this.sp[0]+1]=U(e)})),Y.registerHandler("RAL",(function(t){var e=this.getReg(7),r=+this.status.C;this.status.C=0!=(128&e),this.setReg(7,e<<1|r)})),Y.registerHandler("RAR",(function(t){var e=this.getReg(7),r=+this.status.C;this.status.C=0!=(1&e),this.setReg(7,e>>1|r<<7)})),Y.registerHandler("RC",(function(t){this.status.C&&this.ret()})),Y.registerHandler("RET",(function(t){this.ret(0)})),Y.registerHandler("RLC",(function(t){var e=this.getReg(7);this.status.C=0!=(128&e),this.setReg(7,e<<1|+this.status.C)})),Y.registerHandler("RM",(function(t){this.status.S&&this.ret()})),Y.registerHandler("RNC",(function(t){this.status.C||this.ret()})),Y.registerHandler("RNZ",(function(t){this.status.Z||this.ret()})),Y.registerHandler("RP",(function(t){this.status.S||this.ret()})),Y.registerHandler("RPE",(function(t){this.status.P&&this.ret()})),Y.registerHandler("RPO",(function(t){this.status.P||this.ret()})),Y.registerHandler("RRC",(function(t){var e=this.getReg(7);this.status.C=0!=(1&e),this.setReg(7,e>>1|+this.status.C<<7)})),Y.registerHandler("RST",(function(t){var e=56&t;this.call(0,e,0)})),Y.registerHandler("RZ",(function(t){this.status.Z&&this.ret()})),Y.registerHandler("SBB",(function(t){this.setReg(7,this.sub(this.getReg(7),this.getReg(X(t))+ +this.status.C))})),Y.registerHandler("SBI",(function(t,e){this.setReg(7,this.sub(this.getReg(7),e+ +this.status.C))})),Y.registerHandler("SHLD",(function(t,e,r){this.memory[x(r,e)]=this.getReg(5),this.memory[x(r,e)+1&65535]=this.getReg(4)})),Y.registerHandler("SPHL",(function(t){this.sp[0]=x(this.getReg(4),this.getReg(5))})),Y.registerHandler("STA",(function(t,e,r){this.memory[x(r,e)]=this.getReg(7)})),Y.registerHandler("STAX",(function(t){var e;e=2===t?x(this.registers[0],this.registers[1]):x(this.registers[2],this.registers[3]),this.memory[e]=this.getReg(7)})),Y.registerHandler("STC",(function(t){this.status.C=!0})),Y.registerHandler("SUB",(function(t){this.setReg(7,this.sub(this.getReg(7),this.getReg(X(t))))})),Y.registerHandler("SUI",(function(t,e){this.setReg(7,this.sub(this.getReg(7),e))})),Y.registerHandler("XCHG",(function(t){var e=this.getReg(2),r=this.getReg(3);this.setReg(2,this.getReg(4)),this.setReg(3,this.getReg(5)),this.setReg(4,e),this.setReg(5,r)})),Y.registerHandler("XRA",(function(t){var e=this.getReg(7)^this.getReg(X(t));this.setReg(7,e),this.setFlags(e),this.status.C=!1,this.status.A=!1})),Y.registerHandler("XRI",(function(t,e){var r=this.getReg(7)^e;this.setReg(7,r),this.setFlags(r),this.status.C=!1,this.status.A=!1})),Y.registerHandler("XTHL",(function(t){var e=this.getReg(5),r=this.getReg(4);this.setReg(5,this.memory[this.sp[0]]),this.setReg(4,this.memory[this.sp[0]+1]),this.memory[this.sp[0]]=e,this.memory[this.sp[0]+1]=r}));var J,$=[121,254,9,202,22,236,254,2,202,18,236,118,123,211,1,201,26,254,"$".charCodeAt(0),200,211,1,19,195,22,236],z=(r(0),function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}),G=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var s,n,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},W=new Y,q="";W.output$[1].subscribe((function(t){if(13!==t){8===t?q=q.substr(0,q.length-1):q+=String.fromCharCode(t);var e=document.getElementById("output");e.innerHTML=q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;").replace(/'/g,"&#039;")+'<span class="blinking-cursor"> </span>',e.scrollTop=e.scrollHeight}}));var K=[],Q=null;function tt(){clearTimeout(J),J=null,W.step(),ot()}function et(t){if(!J){document.getElementById("output").focus();var e=(new Date).getTime();!function r(){for(var s=0;s<t;s++)if(W.step(),K.includes(W.pc[0]))return J=null,void ot();ot(),W.running?J=window.setTimeout(r,0):console.log("CPU halted. Ran "+W.cycles+" cycles in "+((new Date).getTime()-e)+" milliseconds.")}()}}function rt(){clearTimeout(J),J=null,W.reset(),q="",document.getElementById("output").innerHTML="",ot()}function st(){var t=document.getElementById("breakpoint"),e=parseInt(t.value,16);if(isNaN(e))return!1;if(K.includes(e))return!1;K.push(e);var r=document.getElementById("breakpoints"),s=document.createElement("option");return s.text=at(e)+": "+W.disasm(e),s.value=e.toString(16),r.add(s),t.value="",!1}function nt(){var t=document.getElementById("breakpoints"),e=t.selectedIndex;if(e<0)return!1;var r=parseInt(t.options.item(e).value,16);return K=K.filter((function(t){return t!==r})),t.options.remove(e),!1}function it(){K=[];for(var t=document.getElementById("breakpoints"),e=t.options.length-1;e>=0;e--)t.options.remove(e)}function ot(){(null===Q||W.pc[0]<Q)&&(Q=W.pc[0]);var t=W.disasm(Q,20);W.pc[0]>t[15][0]&&(Q=W.pc[0],t=W.disasm(Q,20)),document.getElementById("code").innerHTML=t.map((function(t){return"<li "+(t[0]===W.pc[0]?'id="current"':"")+'><span class="tooltip"><span class="address">'+at(t[0])+"</span>: "+t[1]+'<span class="tooltiptext">'+t[2]+"</span></span></li>"})).join(""),document.getElementById("register-values").innerHTML=[0,1,2,3,4,5,6,7].map((function(t){return"<td>"+("00"+W.getReg(t).toString(16)).slice(-2)+"</td>"})).join("");for(var e=Array.from(W.memory.slice(W.sp[0],Math.min(W.sp[0]+40,65535))),r=[],s=W.sp[0];e.length>1;){var n=e.shift()+(e.shift()<<8);r.push("<li>"+("0000"+s.toString(16)).slice(-4)+": "+("0000"+n.toString(16)).slice(-4)+"</li>"),s+=2}document.getElementById("stack").innerHTML=r.join("");var i=Number(document.getElementById("page").value);document.getElementById("memory").innerHTML="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00&#8239;01&#8239;02&#8239;03&#8239;04&#8239;05&#8239;06&#8239;07&#8239;08&#8239;09&#8239;0A&#8239;0B&#8239;0C&#8239;0D&#8239;0E&#8239;0F</b><br>"+Array.from(Array(16).keys()).map((function(t){return"<b>"+("0000"+(256*i+16*t).toString(16).toUpperCase()).slice(-4)+"</b> "+Array.from(Array(16).keys()).map((function(e){return("00"+W.memory[256*i+16*t+e].toString(16)).slice(-2)})).join("&#8239;")+" "+Array.from(Array(16).keys()).map((function(e){return r=W.memory[256*i+16*t+e],(s=String.fromCharCode(r)).match(/[A-Za-z0-9]/)?s:".";var r,s})).join("")})).join("<br>"),document.getElementById("flags").innerHTML="S:"+ +W.status.S+" Z:"+ +W.status.Z+" A:"+ +W.status.A+" P:"+ +W.status.P+" C:"+ +W.status.C,document.getElementById("cycles").innerHTML=W.cycles.toString()}function at(t){return("0000"+t.toString(16)).slice(-4)}function ut(t){8===t.keyCode?(W.input.push(t.keyCode),t.preventDefault(),t.stopPropagation()):27===t.keyCode?document.getElementById("output").blur():t.ctrlKey&&17!==t.keyCode&&(W.input.push(63&t.keyCode),t.preventDefault(),t.stopPropagation())}function ct(t){8!==t.keyCode&&(W.input.push(t.keyCode),t.preventDefault(),t.stopPropagation())}function ht(){var t,e,r=document.getElementById("loadcode").value.replace(/^\s+|\s+$/g,""),s=a.fromHex(r);rt(),W.memory.set([118,0,0,0,0,195,6,236,118],0),W.memory.set($,60422);try{for(var n=z(s),i=n.next();!i.done;i=n.next()){var o=G(i.value,2),u=o[0],c=o[1];W.memory.set(c,u)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}null!==s.ip?W.pc[0]=s.ip:W.pc[0]=256,ot()}function lt(t){var e=new FileReader;e.onload=function(t){document.getElementById("loadcode").value=t.target.result},e.readAsText(t.target.files[0])}function ft(){var t=document.getElementById("programs");if(-1!=t.selectedIndex){var e=t.options.item(t.selectedIndex).value;fetch("programs/"+e).then((function(t){return t.text()})).then((function(t){document.getElementById("loadcode").value=t})).catch((function(t){return console.log(t)}))}}window.onload=function(){document.getElementById("run").onclick=function(){return et(1e4)},document.getElementById("animate").onclick=function(){return et(1)},document.getElementById("step").onclick=tt,document.getElementById("reset").onclick=rt,document.getElementById("setbreakpoint").onclick=st,document.getElementById("clearbreakpoint").onclick=it,document.getElementById("removebreakpoint").onclick=nt,document.getElementById("load").onclick=ht,document.getElementById("output").onkeypress=ct,document.getElementById("output").onkeydown=ut,document.getElementById("page").onchange=ot,document.getElementById("loadfile").onchange=lt,document.getElementById("programs").onchange=ft,fetch("programs/index").then((function(t){return t.text()})).then((function(t){var e=t.split("\n").map((function(t){return t.split(":")})),r=document.getElementById("programs");e.map((function(t){var e=document.createElement("option");e.value=t[0],e.text=t[1],r.options.add(e)})),r.options.selectedIndex=-1})).catch((function(t){return console.log(t)})),ht(),ot()}}]);